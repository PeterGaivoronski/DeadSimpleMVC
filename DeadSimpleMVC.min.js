(function(){var a=true;var b,c;if(typeof P==="undefined"){a=false;b="P.js for object classes";c="https://github.com/jayferd/pjs";}else if(typeof jQuery==="undefined"){a=false;b="jQuery for DOM manipulation";c="http://jquery.com/";}else if(typeof uuid==="undefined"){a=false;b="node-uuid for unique model IDs";c="https://github.com/broofa/node-uuid";}else if(typeof jQuery.publish==="undefined"){a=false;b="jQuery pubsub for publish/subscribe functionality";c="https://github.com/cowboy/jquery-tiny-pubsub";}else if(typeof jQuery.mergeSort==="undefined"){a=false;b="Merge-sort to sort things in place in all browsers";c="https://github.com/justinforce/merge-sort";}if(a===false){console.error("ERROR: Dead Simple MVC needs "+b+". Download at: "+c);return;}(function(a,b,c,d){var e={};var f=a(function(a){a.init=function(){};});var g=a(f,function(a,d){a._id=undefined;a._deleted=false;a.init=function(a){d.init.call(this);this._id=c.v4();this.modify(a);};a.publish=function(a){console.log('publishing action: '+a);b.publish('/models/'+a,[this]);};a.modify=function(a){for(var b in a)if(this.validate(b,a[b])){console.log("setting "+b+" to "+a[b]);this[b]=a[b];}this.publish("modify");};a.del=function(){this._deleted=true;this.publish("delete");};a.validate=function(a,b){return true;};a.serialize=function(){var a={};for(var b in this)if(typeof this[b]!=="function")a[b]=this[b];return JSON.stringify(a);};});e.Model=g;var h=a(f,function(a,b){a.models=undefined;a.init=function(a){b.init.call(this);this.models=a;};a.addElement=function(a){this.models.push(a);};a.removeElement=function(a){var b=[];for(var c=0;c<this.models.length;c++)if(this.models[c]!==a)b.push(this.models[c]);this.models=b;};a.removeDeleted=function(){var a=[];for(var b=0;b<this.models.length;b++)if(this.models[b]._deleted===false)a.push(this.models[b]);this.models=a;};a.sortByParam=function(a,b,c){var d=this.models.mergeSort(function(c,d){if(c[a]>d[a])if(b===true)return 1;else return -1;if(c[a]<d[a])if(b===true)return -1;else return 1;return 0;});if(c===true)this.models=d;else return d;};});e.Collection=h;var i=a(f,function(a,c){a.DOM=undefined;a.actions=undefined;a.template=undefined;a.assignViewEvents=function(){for(var a in this.actions)(function(a,b,c){var d=b[0];var e=b[1];a.off(d);a.on(d,function(){c.sendViewEvent(e);});})(this.DOM.find(a),this.actions[a],this);};a.sendViewEvent=function(a){b.publish('/views/'+a,[this]);};});var j=a(i,function(a,d){a._id=undefined;a.model=undefined;a.init=function(a,e){d.init.call(this);this._id=c.v4();this.model=a;this.subscribeModel("modify."+this._id,b.proxy(this.modifyFunc,this));this.subscribeModel("delete."+this._id,b.proxy(this.deleteFunc,this));this.DOM=e;this.render();};a.render=function(){if(typeof this.model==="undefined")return;var a=this.renderTemplate();this.DOM.html(a);this.assignViewEvents();};a.renderTemplate=function(){return this.template({model:this.model});};a.subscribeModel=function(a,c){b.subscribe('/models/'+a,c);};a.unsubscribeModel=function(a){b.unsubscribe('/models/'+a);};a.modifyFunc=function(a,b){console.log("caught modify event");if(this.model===b)this.render();};a.deleteFunc=function(a,c){if(this.model===c){console.log("publishing view delete. view is: "+this.DOM.html()+" this view's model is: "+this.model.name);b.publish("/views/delete",[this]);this.DOM.html("");this.DOM=undefined;this.model=undefined;b.unsubscribe("."+this._id);}};});e.View=j;var k=a(i,function(a,c){a.models=undefined;a.modelViews=undefined;a.currentSortProperties=undefined;a.viewClass=undefined;a.init=function(a,d,e){c.init.call(this);this.models=a;this.modelViews={};this.DOM=e;this.viewClass=d;for(var f=0;f<a.length;f++)this.createModelView(model);console.log("model views created: "+this.modelViews);this.currentSortProperties={};this.refresh();b.subscribe('/views/delete',b.proxy(this.refresh,this));};a.clear=function(){var a=this.renderTemplate();this.DOM.html(a);this.assignViewEvents();};a.renderTemplate=function(){var a="<div class = 'content'></div>";if(this.template!==undefined)a=this.template({});return a;};a.appendView=function(a){if(this.modelViews[a._id]===undefined)this.createModelView(a);else{var b=this.modelViews[a._id];b.DOM=this.genViewDom();b.render();}};a.createModelView=function(a){this.modelViews[a._id]=this.viewClass(a,this.genViewDom());};a.genViewDom=function(){return b("<div></div>").appendTo(this.DOM.find('.content'));};a.refresh=function(){this.models.removeDeleted();var a=this.sortModelsByProperties();this.clear();for(var b=0;b<a.length;b++)this.appendView(a[b]);};a.sortModelsByProperties=function(){if(this.currentSortProperties.paramName!==undefined){var a=this.currentSortProperties.paramName;var b=true;if(this.currentSortProperties.ascending!==undefined)b=this.currentSortProperties.ascending;return this.models.sortByParam(a,b,false);}else return this.models.models;};});e.MetaView=k;var l=a(f,function(a,c){a.events=undefined;a.init=function(){c.init.call(this);for(var a in this.events)b.subscribe('/views/'+a,this.events[a]);};});e.Controller=l;d.DeadSimpleMVC=e;})(P,jQuery,uuid,window);})();