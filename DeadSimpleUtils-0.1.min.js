(function(){var a=true;var b,c;if(typeof P==="undefined"){a=false;b="P.js for object classes";c="https://github.com/jayferd/pjs";}else if(typeof jQuery==="undefined"){a=false;b="jQuery for DOM manipulation";c="http://jquery.com/";}else if(typeof uuid==="undefined"){a=false;b="node-uuid for unique model IDs";c="https://github.com/broofa/node-uuid";}else if(typeof jQuery.publish==="undefined"){a=false;b="jQuery pubsub for publish/subscribe functionality";c="https://github.com/cowboy/jquery-tiny-pubsub";}else if(typeof jQuery.mergeSort==="undefined"){a=false;b="Merge-sort to sort things in place in all browsers";c="https://github.com/justinforce/merge-sort";}else if(typeof DeadSimpleMVC==="undefined"){a=false;b="DeadSimpleMVC for core code";c="https://github.com/PeterGaivoronski/DeadSimpleMVC";}else if(typeof Handlebars==="undefined"){a=false;b="Handlebars for templating";c="https://github.com/wycats/handlebars.js/";}if(a===false){console.error("ERROR: Dead Simple Utils needs "+b+". Download at: "+c);return;}(function(a,b,c,d){var e={};var f={};var g={};var h;var i;var j=setInterval(function(){i=new Date().getTime();for(h in g)if(g[h][0]+g[h][1]<i){g[h][0]=i;g[h][2]();}},13);f.animations=g;e.Anim=f;var k={};var l=c.compile("        <form class = 'mainForm'></form>        <div class = 'submit'>Submit</div>        ");k.formTemplate=l;var m=c.compile("        <span class = 'column'>{{displayName}}</span>        <span class = 'column inputColumn'>{{{input}}}</span>        ");k.columnTemplate=m;var n={name:/^[A-Za-z0-9 ]{2,20}$/,email:/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i,telephone:/^\(?[0-9]{3}\)?\-?[0-9]{3}\-?[0-9]{4}$/,month:/^([1-9]|[1][0-2])$/,year2Digit:/^[0-9]{2}$/,year4Digit:/^[0-9]{4}$/,state:/^[A-Za-z]{2}$/,zip:/^[0-9]{5}$/,creditCardNumber:/^[0-9]{4}\-?[0-9]{4}\-?[0-9]{4}\-?[0-9]{4}$/,creditCardCV:/^[0-9]{3}$/};k.ValidationRegex=n;var o=c.compile("        <span class = 'inputMessage {{valid}}'>{{message}}</span>        ");k.inputMessageTemplate=o;var p=c.compile("        <input type = 'text' class = 'input {{model.valid}}' name = '{{model.name}}' value = '{{model.value}}' /><br>        {{{inputMessage}}}        ");k.inputTextTemplate=p;var q=c.compile("        <input type = 'password' class = 'input {{model.valid}}' name = '{{model.name}}' value = '{{model.value}}' /><br>        {{{inputMessage}}}        ");k.inputPasswordTemplate=q;var r=c.compile("        <input type = 'checkbox' class = 'input {{model.valid}}' name = '{{model.name}}' value = '{{model.value}}' {{checked}} /><br>        {{{inputMessage}}}        ");k.inputCheckboxTemplate=r;var s=c.compile("        <input type = 'hidden' class = 'input {{model.valid}}' name = '{{model.name}}' value = '{{model.value}}' />        ");k.inputHiddenTemplate=s;var t=c.compile("        <select class = 'input {{model.valid}}' name = '{{model.name}}' value = '{{model.value}}'>{{{options}}}</select>        {{{inputMessage}}}        ");k.inputSelectTemplate=t;var u=c.compile("        <option value = '{{optionValue}}' {{selected}}>{{optionName}}</option>        ");k.selectOptionTemplate=u;var v=b(d.Model,function(a,b){a.name="";a.displayName="";a.value="";a.inputType="";a.required=false;a.requiredValue=undefined;a.valid="";a.invalidMessage="Incorrectly Formatted Input";a.blankMessage="Required";a.validType="";a.inputChoices=undefined;a.initialDisplay=true;a.displayGroup=false;a.noTable=false;a.customTemplate=undefined;a.validateValue=function(){if(this.initialDisplay===true){this.valid="valid";return true;}if(typeof this.requiredValue!=="undefined")if(this.value!==this.requiredValue){this.valid="invalid";return false;}if(this.required===true&&this.value===""){this.valid="blank";return false;}var a=n[this.validType];if(typeof a!=="undefined")if(a.test(this.value)===false){this.valid="invalid";return false;}this.valid="valid";return true;};a.modify=function(a){if(typeof a.value==="number")a.value=a.value.toString();b.modify.call(this,a);};});k.InputField=v;var w=b(d.Model,function(a,b){a.name="";a.displayName="";a.template=undefined;});k.DisplayGroup=w;var x=b(d.View,function(a,b){a.template=undefined;a.templateMap={'text':p,'select':t,'password':q,'checkbox':r,'hidden':s};a.init=function(a,c){if(typeof a.customTemplate!=="undefined")this.template=a.customTemplate;else for(var d in this.templateMap)if(a.inputType===d){this.template=this.templateMap[d];break;}b.init.call(this,a,c);};a.genTemplateArguments=function(){var a=this.getModel();a.validateValue();var b=a.invalidMessage;if(a.valid==="blank")b=a.blankMessage;var c=o({message:b,valid:a.valid});return{inputMessage:c,model:a};};a.renderTemplate=function(){var a=this.genTemplateArguments();switch(a.model.inputType){case "select":var b="";var c;var d;for(var e in a.model.inputChoices){c=a.model.inputChoices[e];if(typeof c==="number")c=c.toString();if(c===a.model.value)d='selected';else d='';b+=u({optionName:e,optionValue:c,selected:d});}a.options=b;break;case "checkbox":a.checked=a.model.value===true?"checked":"";break;}if(a.model.displayGroup===false&&a.model.noTable===false)return m({displayName:a.model.displayName,input:this.template(a)});else return this.template(a);};a.actions={'.input':{'change':['validateInput'],'blur':['validateInput']}};a.serialize=function(){var a=this.DOM.find('.input');var b;var c=this.getModel();switch(c.inputType){case "text":case "password":case "select":case "hidden":b=a.val();break;case "checkbox":b=a.is(":checked");break;}console.log(b);c.modify({value:b});};});k.InputFieldView=x;var y=b(d.MetaView,function(b,c){b.template=l;b.viewClass=x;b.genViewDom=function(b){var c;var d=this.DOM.find('.mainForm');if(b.displayGroup===false&&b.noTable===false)return a("<div class = 'row'></div>").appendTo(d);else if(b.displayGroup!==false&&b.noTable===false){var e=this.DOM.find('.displayGroup'+b.displayGroup._id);if(e.length===0){e=a("<div class = 'row displayGroup"+b.displayGroup._id+"'></div>").appendTo(d);e.html(b.displayGroup.template({displayName:b.displayGroup.displayName}));}return a("<div class = 'viewGroupElement'></div>").appendTo(e.find(".inputColumn"));}else return a("<div></div>").appendTo(d);};b.retrieveData=function(){var a={};var b;var c=true;for(var e=0;e<this.models.elements.length;e++){b=d.ModelRegistry[this.models.elements[e]];if(b.initialDisplay===true)b.modify({initialDisplay:false});if(b.valid!=="valid")c=false;a[b.name]=b.value;}if(c===false)return false;return a;};b.serialize=function(){var a;for(var b in this.modelViews){a=d.ViewRegistry[this.modelViews[b]];a.serialize();}};b.actions={'.submit':{'click':['submitForm']}};});k.FormMetaView=y;var z=b(d.Controller,function(a,b){a.events={'validateInput':function(a,b){b.serialize();var c=b.getModel();if(c.initialDisplay===true)c.modify({initialDisplay:false});},'submitForm':function(a,b){b.serialize();var c=b.retrieveData();if(c===false)return;console.log("submitting form with "+JSON.stringify(c));}};});k.FormController=z;e.Form=k;var A={};var B=c.compile("        <div class = 'message'>{{{model.message}}}</div>        <div class = 'submit ok'>OK</div>        ");A.popupTemplate=B;var C=b(d.Model,function(a,b){a.message='';});A.PopupModel=C;var D=b(d.View,function(a,b){a.template=B;a.render=function(){b.render.call(this);this.DOM.show();};a.actions={'.ok':{'click':['popupOk']}};});A.PopupView=D;var E=b(d.Controller,function(a,b){a.events={'popupOk':function(a,b){b.DOM.hide();}};});A.PopupController=E;e.Popup=A;d.Utils=e;})(jQuery,P,Handlebars,DeadSimpleMVC);})();